<?phpnamespace App\Controllers;use Irsyadulibad\DataTables\DataTables;class Review extends BaseController{    public function json($status = "dikirim")    {        $query = DataTables::use('pengajuan')                ->select('pengajuan_id,no_invoice,tgl_invoice,client.nama_client as nama_client,status_dokumen,keterangan_status,users.name as reviewer,pengajuan.created_at as created_at,pengajuan.updated_at as updated_at')                ->join('client', 'client_id', 'left')                ->join('users', 'users.user_id=pengajuan.reviewer', 'left')                ->where(['status_dokumen'=>$status])                ->make(true);        return $this->response->setJSON($query);    }    public function index()    {        $data = [            'title'     => 'Daftar Pengajuan'        ];        return view('review/data', $data);    }        public function ajaxGetNoUrut()    {        $data['noVlegal'] = $this->terkirim->getNoUrut();        return $this->response->setJSON($data);    }    public function detail($id=null)    {        $pengajuan = $this->pengajuan->detail($id);        $data = [            'title'         => 'Review Pengajuan',            'pengajuan'     => $pengajuan,            'detail'        => $this->detail->get($id),            'total'         => $this->detail->getTotal($id),            'pejabat'       => $this->pejabat->get(),            'jenis_kayu'    => $this->kayu,            'negara'        => $this->negara,            'buyer'         => $this->buyer->get($pengajuan['buyer_id']),            'no_urut'       => $this->terkirim->getNoUrut()        ];        $lampiran = $this->lampiran;        $jenis = ['lmk','permohonan','invoice','packing_list','po', 'cites', 'peb'];        $data['lampiran'] = [];        foreach ($jenis as $j) {            $data['lampiran'][] = $lampiran->where(['jenis_file'=>$j,'pengajuan_id'=>$id])->first();        }        return view('review/detail', $data);    }    public function reject()    {        $input = $this->request->getVar(null, FILTER_SANITIZE_STRING);        $this->pengajuan->save($input);        setToast('success', 'Permohonan telah direject');        return redirect()->to('/review');    }}