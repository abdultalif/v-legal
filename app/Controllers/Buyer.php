<?phpnamespace App\Controllers;use Irsyadulibad\DataTables\DataTables;class Buyer extends BaseController{    public function json()    {        $current_user = userdata('user_id');        $role = userdata('role');                if ($role != "superadmin") {            $query = DataTables::use('buyer')                ->select('kode_negara as kode_negara,nama_client as nama_client,buyer.*')                ->join('negara', 'negara_id', 'left')                ->join('client', 'user_id', 'left')                ->where(['user_id'=>$current_user])                ->make(true);        } else {            $query = DataTables::use('buyer')                ->select('kode_negara as kode_negara,nama_client as nama_client,buyer.*')                ->join('negara', 'negara_id', 'left')                ->join('client', 'user_id', 'left')                ->make(true);        }                return $this->response->setJSON($query);    }    public function index()    {        $data = [            'title'     => 'Data Buyer'        ];        return view('buyer/data', $data);    }    public function add()    {        $data = [            'title'         => 'Tambah Buyer',            'negara'        => $this->negara->get(),            'validation'    => $this->validation        ];        return view('buyer/add', $data);    }    private function _rules()    {        $this->validation->setRules([            'negara_id' => ['label' => 'Negara', 'rules' => 'required'],            'nama_buyer' => ['label' => 'Nama Buyer', 'rules' => 'required'],            'alamat_buyer' => ['label' => 'Kode Buyer', 'rules' => 'required'],            'status' => ['label' => 'Status', 'rules' => 'required|numeric'],        ]);    }    public function save()    {        $this->_rules();        if (!$this->validation->withRequest($this->request)->run()) {            return redirect()                ->to('/buyer/add')                ->withInput()                ->with('validation', $this->validation);        }        $input = $this->request->getVar(null, FILTER_SANITIZE_STRING);        unset($input['csrf_test_name']);        $this->buyer->save($input);        setToast('success', "Data berhasil disimpan");        return redirect()->to('/buyer');    }    public function delete($id)    {        if ($this->request->getMethod() !== 'delete') {            return redirect()->to('/user');        }        $this->buyer->delete($id);        setToast('success', "Data berhasil dihapus");        return redirect()->to('/buyer');    }    public function multi_delete()    {        $checked = $this->request->getVar('checked', FILTER_SANITIZE_STRING);                foreach ($checked as $id) {            $this->buyer->delete($id);        }        setToast('success', "Data berhasil dihapus");        return redirect()->to('/buyer');    }    public function edit($id)    {        $data = [            'title'         => 'Edit Buyer',            'negara'        => $this->negara->get(),            'validation'    => $this->validation,            'buyer'      => $this->buyer->get($id)        ];        return view('buyer/edit', $data);    }    public function update()    {        $this->_rules();        $input = $this->request->getVar(null, FILTER_SANITIZE_STRING);        unset($input['csrf_test_name']);                if (!$this->validation->withRequest($this->request)->run()) {            return redirect()                ->to('/buyer/edit/'.$input['buyer_id'])                ->withInput()                ->with('validation', $this->validation);        }        $this->buyer->save($input);        setToast('success', "Data berhasil diupdate");        return redirect()->to('/buyer');    }}